# אפיון אפליקציית קארדז - ממשק בעלי עסקים
## מסמך אפיון אחיד ומעודכן


**תאריך עדכון:** 2024-12-19  
**גרסה:** 1.0 Final  
**פלטפורמה:** React Web PWA


---


## כללי - מטרה ויעדים


מטרת הממשק לתת מידע ואפשרויות פונקציות הכרטיסייה. 


ממשק זה מתחלק לממשק ניהול וממשק המפתח. (הגישה לממשק המפתח תהיה מתוך ממשק הניהול עם סמל של גלגל שיניים ומאובטח ברמה הגבוהה ביותר או ממשק וובי אם זה לא מסבך את האפליקציה)


לממשק ניהול בקאנד אין אפליקציה נפרד- הכניסה מתוך מסך ראשי תפריט המבורגר פריט "כניסת עסקים"


נדרשת רמת אבטחה לכניסה זו - רצוי דרך אימייל וסיסמה או כל רמה אחרת גבוהה.


ממשק זה תהיה כניסה לממשק המפתח שיפותח בשלב הבא.


---


## מחסנית טכנולוגית ופלטפורמה


### טכנולוגיות עיקריות:
- **React Web** - ממשק רספונסיבי מלא
- **TypeScript** - type safety וקוד משותף
- **Vite** - build tool מהיר ומודרני
- **Supabase** - מסד נתונים וAPI (קיים)
- **PWA (Progressive Web App)** - פלטפורמת הפצה


### פלטפורמת הפצה - PWA:


**מה זה PWA:**
- אפליקציית ווב שמתנהגת כמו אפליקציה נייטיבית
- "התקנה" דרך הדפדפן לשולחן העבודה/מסך הבית
- עובדת כמו אפליקציה רגילה (אייקון, חלון נפרד)
- עדכונים אוטומטיים ללא מעורבות המשתמש


**יתרונות PWA עבור בעלי עסקים:**
✓ התקנה קלה - "Add to Home Screen" ללא חנויות אפליקציות
✓ עובדת על כל פלטפורמה - Windows, Mac, iPad, Android tablets
✓ עדכונים מיידיים - אין צורך באישורים או הורדות
✓ נראית מקצועית - אייקון בשולחן העבודה, פותחת כאפליקציה
✓ אין תלות בדפדפן - חלון נפרד ללא כתובת URL


**תהליך התקנה:**
1. בעל עסק נכנס לכתובת ווב מהטאבלט/מחשב
2. הדפדפן מציע אוטומטית "התקן אפליקציה"
3. לחיצה אחת - האפליקציה מותקנת
4. אייקון נוצר בשולחן העבודה/מסך הבית
5. שימוש רגיל כמו אפליקציה נייטיבית


---


## מבנה ארכיטקטוני


### הפרדת ממשקים:
- **ממשק לקוחות**: React Native (מובייל בלבד) - read-only + ברקוד
- **ממשק בעלי עסקים**: React Web PWA - ניהול מלא, רספונסיבי


### עיצוב רספונסיבי מלא:


**טאבלט/iPad (1024×768 ומעלה):**
הממשק לטבלט יבנה באופן של תפריט נפתח בציר Y לאורך המסך (אפשרות ידידותית לפתוח ולהסתיר התפריט) כאשר המעבר בין פרטי התפריט יתבצע לאורך הציר. בעת מעבר פריט תפריט הוא יואר/יסומן על גבי ציר התפריט והתוכן כולל הכותרת יתחלפו בהתאם לפריט הנבחר.


- תפריט צד קבוע (Sidebar Navigation)
- תוכן ראשי במרכז
- פריט תפריט מואר/מסומן
- תוכן מתחלף ללא טעינה מחדש


**מובייל/סלולרי (פחות מ-1024px):**
הממשק לסלולר יתבצע עם תפריט המבורגר שיפתח ממסך הכניסה לממשק והצגת כל בחירת פריט בדף נפרד למילוי ושינוי עם אפשרות לחזרה לתפריט ראשי בכל מסך. כל פריט תפריט יהיה במסך גלילה נפרד כאמור.


- תפריט המבורגר
- דפים נפרדים לכל פונקציה
- אפשרות חזרה לתפריט ראשי מכל מסך
- גלילה אנכית לכל דף


**דסקטופ רחב:**
- תפריט צד מורחב עם תיאורים
- תוכן רחב עם עמודות נוספות
- ניצול מקסימלי של שטח המסך


בכל אחד מהדפים בסלולר ובתצוגת האייפד המאוזנת ירשם שם העסק והלוגו בצד ימין שיקראו דינמית מתוך סופרבייס ולוגו קבוע (לא דינמי) של CARDZ.


---


## מצבי תצוגה ועיצוב


### Dark/Bright Mode:
במסך הכניסה - אפשרות להחלפת MODE כאשר ברירת המחדל היא DARK MODE (גם התפריט וגם תוכן הדף) ואפשרות ל-BRIGHT MODE כאשר בוחרים בו פרטי התפריט נשארים בדארק מוד והתוכן בהיר.


- **Dark Mode** - ברירת מחדל (תפריט + תוכן כהים)
- **Bright Mode** - תפריט כהה + תוכן בהיר
- מתג מעבר במסך הכניסה
- שמירת העדפת המשתמש


### ריבוי שפות + RTL:
בורר שפות שיתרגם את כל הטקסטים כולל הכפתורים והתכנים לאנגלית, צרפתית, ספרדית וערבית כולל הפיכת כיוון טבלאות ותצוגת ממשק בהתאם לכיוון קריאת השפה.


- **עברית** (ברירת מחדל) - RTL
- **אנגלית** - LTR
- **צרפתית** - LTR  
- **ספרדית** - LTR
- **ערבית** - RTL
- הפיכת כיוון טבלאות וממשק בהתאם לשפה
- תרגום מלא של כל הטקסטים והכפתורים


---


## מערכת הזדהות ואבטחה


### שינויים במערכת הכניסה:
- **במקום**: מספר טלפון (כמו בממשק לקוחות)
- **חדש**: אימייל + סיסמה לבעלי עסקים
- **רמת אבטחה גבוהה** כפי שנדרש במסמך האפיון
- **Multi-tenant** - הפרדה מוחלטת בין עסקים


### רמות הרשאה:
1. **עובד** - פעולות ניקוב רגילות
2. **מנהל/משמרת** - כל הפעולות + פעולות רגישות
3. **בעל עסק** - שליטה מלאה + הגדרות


### אבטחת נתונים:
- Row Level Security (RLS) מחמיר יותר
- כל עסק רואה רק את הנתונים שלו
- הרשאות ברמת פונקציה (פוש, ביטול ניקוב, יבוא/יצוא)


---


## מבנה התפריט הראשי


### 8 פריטי תפריט עיקריים:


**1. תפעול ניקובים**
- מסך ראשי עם טבלת לקוחות
- סריקת ברקוד, הוספת לקוח, חיפוש וסינון
- פעולות: ניקוב, עריכה, מחיקה לכל לקוח


**2. פרסום**
- הודעות פוש (ידניות ואוטומטיות)
- פופאפים (כניסה ואחרי ניקוב)
- הגרלות עם ניהול זוכים
- שוברים והטבות (עד 10 סוגים)
- חבר מביא חבר


**3. לוג/תיעוד פעולות**
- היסטוריה מלאה של כל פעולות העסק והלקוחות
- חיפוש וסינון לפי פרמטרים שונים
- ייצוא נתונים


**4. דשבורד ניהולי**
- סטטיסטיקות וגרפים
- ניתוח לקוחות ותדירות ביקורים
- חישובי כדאיות כלכלית
- דוחות בחתכי זמן


**5. ניהול תוכניות וחיובים**
- מסלולי תשלום
- מעקב אחר מכסות פוש
- רכישת חבילות נוספות


**6. הגדרות** (תת-תפריט):
- **הגדרות העסק**: פרטים, לוגו, צבעי ברנד, אנשי קשר
- **הגדרות כרטיסייה**: מספר ניקובים, אייקונים, הנחות תשלום מראש
- **הגדרות מערכת**: גיבויים, יבוא/יצוא, הרשאות משתמשים


**7. צור קשר**
- פנייה לתמיכה
- AI צ'אטבוט לעזרה טכנית (תכנון עתידי)


**8. עזרה**
- מדריכים לשימוש
- שאלות נפוצות
- תמיכה טכנית


---


## סביבת פיתוח ואינטגרציה


### מבנה Monorepo:
```
cards_project/
├── apps/
│   ├── mobile/              # React Native (ממשק לקוחות - קיים)
│   ├── web-admin/           # React Web (ממשק בעלי עסקים - חדש) 
│   └── landing/             # דף נחיתה (אופציונלי)
├── packages/
│   ├── shared-types/        # TypeScript interfaces
│   ├── shared-utils/        # פונקציות משותפות
│   ├── supabase-client/     # API layer משותף
│   └── design-system/       # UI components משותפים
├── tools/
│   ├── build-scripts/       # סקריפטים לבנייה
│   └── deployment/          # סקריפטי פריסה
└── environments/            # הגדרות סביבות
    ├── dev/
    ├── staging/
    └── production/
```


### כלי ניהול Monorepo:
**Yarn Workspaces** - ניהול dependencies משותף ובuild מהיר עם caching


### סביבות פיתוח:


**Development (Local):**
- **Web Admin**: `yarn web:dev` - Vite dev server
- **Shared packages**: הוט reload אוטומטי
- **Database**: Supabase local instance או staging


**Staging (Testing):**
- **Web Admin**: Vercel/Netlify staging URL - `staging.cardzapp.com`
- **Database**: Supabase staging environment
- **משתמשים**: עסקים בטא/טסט


**Production:**
- **Web Admin**: PWA ב-production domain - `admin.cardzapp.com`
- **Database**: Supabase production
- **משתמשים**: לקוחות אמיתיים


### תהליך CI/CD:
```
# פיתוח
on: push to develop
  → Build web (staging)
  → Deploy to staging environments
  → Run automated tests


# שחרור
on: push to main
  → Build web PWA (production) 
  → Deploy to production
  → Create release tags
```


### ניהול גרסאות:
- **Semantic Versioning** - v1.2.3
- **Web PWA**: עדכונים מיידיים (מהיר)
- **תאימות לאחור** עם Supabase API


---


## אינטגרציה עם מערכת קיימת


### BusinessContext מותאם:
- הרחבה לתמיכה בריבוי עסקים
- הפרדת הרשאות לפי משתמש מחובר
- שיתוף טיפוסים עם React Native


### Supabase Integration:
- אותם טבלאות ומבנה DB
- RLS (Row Level Security) מחמיר יותר לממשק המנהל
- Real-time updates לשינויים בזמן אמת
- אותו API ופונקציות


### קוד משותף:
- TypeScript interfaces וטיפוסים
- פונקציות עזר (utils)
- Supabase client ופונקציות API
- קבועים ו-enums


---


## מסך תפעול ניקובים - פירוט מלא


### כפתורי פעולה ראשיים:
1. **כפתור מצלמה**: לפתיחת סריקת ברקוד לניקוב/בדיקת (לניקוב אוטומטי)
2. **ניקוב NFC**: מתבצע אוטומטית ברקע ללא כפתור
3. **כפתור הוספת לקוח [+]**: פותח טופס הצטרפות מלא עם כל השדות (שם, טלפון, מוצר, יום הולדת, תשלום, הערות)
4. **כפתור "לוג פעילויות לקוחות"**: פותח היסטוריית כל פעולות הלקוח (במסך נפרד/מודאל)
5. **שדה חיפוש**: מאפשר סינון לפי שם לקוח, מספר טלפון, מוצר, תשלום, סטטוס, פעולה אחרונה


### טבלת כרטיסיות לקוחות:


**עמודות (מימין לשמאל):**
- שם לקוח
- מספר לקוח
- טלפון
- מוצר
- ניקובים (X/XX + שורת אייקונים חזותיים)
- סטטוס/פעולה אחרונה
- תשלום מראש
- ת. פעולה אחרונה
- תוקף (בהתאם לבחירת העסק בהגדרות)


**שורת פעולות (אייקונים - מסופקים ע"י המפתח):**
1. **מכשיר ניקוב**: פותח פופאפ כרטיסיית הלקוח לביצוע פעולות
2. **עריכה**: פותח מסך עריכת לקוח עם כל השדות
3. **מחיקה**: פותח חלונית אישור למחיקה


### פופאפ/מודאל כרטיס ניקוב:
- מציג את כרטיסיית הלקוח כפי שהיא מעוצבת בממשק הלקוח
- תצוגה גרפית מלאה בטלפון וטאבלט (מאוזן)
- תצוגת הכרטיסיה: בהירה כפי שהיא מופיעה בפרונטאנד


**5 כפתורי פעולה בתחתית:**
1. **ניקוב** — מוסיף ניקוב יחיד
2. **ניקוב מרובה** — פותח שדה להזנת מספר ניקובים
3. **חידוש כרטיסיה** — מאפס ניקובים, מתחיל כרטיסיה חדשה
4. **ביטול ניקוב** — מאפשר למחוק כל ניקוב, דורש סיסמת מנהל
5. **כפתור סגירה (X)** או "חזור" — מחזיר למסך הראשי


### פונקציונליות ניקוב אוטומטי/חצי אוטומטי:


**סוגי ניקוב:**
- **ברקוד**: לחיצה על כפתור → פתיחת מצלמה → סריקה → ניקוב
- **NFC**: אוטומטי ברקע ללא כפתור


**מצבי פעולה:**
- **אוטומטי מלא**: ברקוד נסרק → ניקוב מיידי + פופאפ תודה
- **חצי אוטומטי**: ברקוד נסרק → פתיחת כרטיסיית הלקוח לבחירה ידנית


**טיפול בשוברים:**
אם יש ללקוח שובר - תופיע הודעה לפני ניקוב: "יש לך שובר, האם לממש?"


---


## פרסום - מרכז קמפיינים


### מבנה ותצוגה:
- **טאבלט**: טאבים נפרדים לכל סוג קמפיין
- **מובייל**: כל הפיצ'רים בגלילה אחת עם כותרות ברורות


### 1. הודעות פוש:


**פוש ידני:**
- כותרת הודעה (חובה)
- גוף הודעה (חובה)
- בחירת קהל: כל הלקוחות/בחירה ידנית/פילוח מתקדם
- תזמון: מיידי/מתוזמן
- בחירת שפה
- אפשרות הוספת תמונה


**פושים אוטומטיים:**
1. **פוש לפי תזמון ספציפי**: שדה הודעה + תאריך/שעה + הפעל/השבת
2. **פוש ללקוחות שלא ביקרו**: הודעה + ימים מביקור + צ'קבוקס שובר
3. **פוש ימי הולדת**: הודעה + צ'קבוקס הפעלה + צ'קבוקס שובר
4. **פוש השלמת כרטיסיה**: הודעה + ניקובים להשלמה + תנאים


### 2. פופאפים:
- כותרת/כפתור קריאה לפעולה
- גוף הפופאפ/מבצע
- זמן השהייה
- מס' הופעות פר לקוח
- מקום הקפצה (כניסה/אחרי ניקוב)
- העלאת תמונה


### 3. הגרלות:
- שם הגרלה
- בחירת תאריכים
- סוג הטבה/שובר
- תיאור ותנאים
- קהל יעד
- הפעלה/השבתה


### 4. שוברים/הטבות:
- שם השובר (עד 10 סוגים לעסק)
- סוג שובר
- ערך/הטבה
- קהל יעד
- תוקף
- סוג הפעלה: אוטומטי/ידני


### 5. חבר מביא חבר:
- הפעלה/ביטול בהגדרות העסק
- סוג שובר מתנה למזמין ולמוזמן
- מעקב מלא על ההפעלה ומימוש


---


## דשבורד ניהולי וסטטיסטיקות


### חלונית בחירת חתך זמן:
- מתחילת התוכנית
- מתחילת החודש
- בחירה אישית (לוח שנה)


### נתונים מוצגים:
- סה"כ מספר לקוחות חדשים (עם טבלת עמודות לפי חודשים)
- מתוכם הצטרפות מרחוק (רישום עצמי)
- מתוכם "חבר מביא חבר"
- מתוכם הרשמה בבית העסק
- מספר לקוחות שהפעילו "חבר מביא חבר"
- מספר כרטיסיות
- מספר מימוש הטבות
- מספר ניקובים
- מספר לקוחות מנקבים בתדירות יומית/שבועי/חודשית
- מספר לקוחות שלא ביקרו בעסק חודש/חודשיים/מעל שלושה חודשים
- לקוחות שצפו בכרטיסייה
- זמן ממוצע בשניות של שהייה בכניסה לכרטיסייה
- זמן ממוצע בשניות של שהייה בכרטיסייה עצמה
- לקוחות שיצרו קשר מהאפליקציה
- סטטיסטיקות פוש (נשלחו/נצפו/לא קיבלו)
- מצב כמות שליחת הודעות פוש מול מכסת החבילה
- סטטיסטיקות שוברים (הונפקו/נוצלו/לא נוצלו/לפני תפוגה)
- רשימת זוכי ההגרלות


### חישובי כדאיות כלכלית:


**שדות להכנסת נתונים:**
- ערך ניקוב
- ערך הטבה
- ערך שובר


**חישובים:**
- **אחוז ההשקעה בתוכנית**: (ערכי הטבה + שוברים) ÷ ערכי הניקוב
- **רווחיות תוכנית**: תוספת ניקובים ÷ (ערכי הטבה + שוברים) - 1


---


## הגדרות מפורטות


### הגדרות העסק:


**שדות עיקריים:**
- שם העסק (ניתן לעריכה)
- שם משפטי אם שונה
- כתובת אימייל לקבלת הודעות/חשבוניות
- מספר ח.פ או ע.מ
- סוג/תחום עסק (תפריט נפתח - מסעדה/בית קפה/טיפול ציפורניים/קוסמטיקה ויופי/כושר/עיסויים/שטיפת רכבים/פרחים/מתנות/מזון מהיר/מיצים ושייקים/גלידות/מאפים/פיצרייה/חיות/מספרה/הסרת שיער/מוסך/בגדים/נעליים/תכשיטים ואקססוריס/אופטיקה ומשקפיים/סטודיו חוגים/משחקים וצעצועים/מורה פרטי/נהיגה/צילום ופיתוח/אחר)
- כתובת מלאה (רחוב, מספר, עיר, מיקוד)
- טלפון עסקי ראשי
- מזהה עסק (business_code, הקצאה אוטומטית 1-99000)
- כתובת אתר/URL (אופציונלי)
- כתובת תפריט/URL (אופציונלי)
- לוגו (העלאה/ברירת מחדל כארגז)
- צבעי ברנד (מניפת צבעים, HEX)
- אנשי קשר (רשימה עד 2: שם, טלפון, תפקיד)
- הערות פנימיות


**ניהול והרשאות:**
- רמות הרשאה: עובד / מנהל (מקום/משמרת)
- טבלת משתמשים (שם, טלפון, דוא"ל, תפקיד)
- הוספה/עריכת/מחיקת משתמש (ברמת הרשאה 1 בלבד)
- הקצאת סיסמת מנהל/משמרת לפעולות רגישות


### הגדרות כרטיסייה:
- מספר כרטיסייה (הקצאה של סופרבייס)
- תאריך הנפקה
- מספר ניקובים מקסימלי
- מספר ניקובים מזכה
- סוג הבונוס בהשלמת כרטיסייה
- תקופת פקיעת הכרטיסיה (חודשים או לצמיתות)
- הנחה על תשלום מראש (צ'קבוקס + אחוזים)
- הגדרת מוצרים לניקוב (טבלה עם מוצר ומספר פנימי)


**אייקונים:**
- אייקון לניקוב (לפני ניקוב) - בחירה מתוך מאגר או העלאה
- אייקון מנוקב (אחרי ניקוב) - בחירה מתוך מאגר או העלאה
- תמונת נושא בכניסה לכרטיסייה
- צבע ברנד לטקסטים ותפריטים


**הגדרות ניקוב:**
- ניקוב אוטומטי (צ'קבוקס) - ללא התערבות ידנית
- ניקוב חצי אוטומטי (צ'קבוקס) - פתיחת כרטיסייה לביצוע ידני


### הגדרות מערכת:
- גיבוי ידני יזום למכשיר
- גיבוי אוטומטי לסופרבייס (אינטרוול: כל שעה/4/6/12 שעות)
- שחזור נתונים
- יבוא לקוחות (Excel/CSV עם הוראות פורמט)
- יצוא לקוחות (Excel/CSV)


---


## לוג/תיעוד פעולות


לוג שמתעד את כל פעולות הלקוח של העסק ושל העסק עצמו:
- גיבויים ושחזורים
- שם משתמש של העסק
- עדכוני גרסה
- יבוא או יצוא של רשימת לקוחות
- פעולות לקוחות: פתיחת האפליקציה, זמן צפייה, יצירת קשר, קבלת הטבות, ניקובים, חידושי כרטיסייה, זכייה בהגרלה


**הערה:** הלוגים הקשורים לפעילות לקוחות יהיו זמינים לצפיה בממשק הלקוח בפריט תפריט "הפעילות שלי". הלוגים של בית העסק והמערכת לא זמינים ללקוחות העסק.


---


## ניהול תוכניות ותשלומים


### הצגת סוגי מסלולי התוכניות:
(עם אפשרות שינוי לממשק המפתח העתידי)


### רכישת חבילות:
אפשרות לרכוש חבילות של 1000 פושים בנפרד לפי מסלול התוכנית לאחר ניצול הפושים בחינם


### מעקב מכסות:
- מצב כמות שליחת הודעות פוש מול מכסת החבילה
- כפתור "רכוש חבילה"


---


## עזרה/צור קשר


### תשתית לחלונית שיחה עם סוכן AI:
(לרשום בטודו ליסט להשלים חלונית)


הסוכן יהיה מקושר ב-MCP לנתוני חיוב של הלקוח, לתנאי המסלולים, לבעיות נפוצות, להדרכה בשימוש באפליקציה לדשבורד של העסק ויוכל גם לייעץ וגם להפיק דוחות חיוב לפי דרישה.


### אבטחת הסוכן:
תשתית אבטחה לסוכן של סיסמה ווידוא טלפוני אם המשתמש מעוניין במידע שקשור לעסק שלו.


### איך הסוכן יכול לעזור:
הסבר מפורט על יכולות הסוכן


### יצירת קשר:
אימייל: yula@yuladigital.com


---


## שינויים נדרשים במסמך האפיון המקורי


### עדכונים שבוצעו:


1. **החלפת הפלטפורמה**:
   - במקום: "ממשק ניהול וובי רץ מצוין על נוטבוק/אייפד (ואפילו נייד)"
   - חדש: "ממשק ניהול ווב בטכנולוגיית React Web + TypeScript PWA לרספונסיביות מלאה"


2. **מבנה ארכיטקטוני מעודכן**:
   - הוספת פירוט על עיצוב רספונסיבי
   - הגדרת התנהגות לטאבלט לעומת מובייל
   - מפרט טכני מפורט


3. **מערכת הזדהות**:
   - החלפת שיטת הכניסה לבעלי עסקים
   - הוספת רמות הרשאה מפורטות
   - אבטחה מחמירה יותר


4. **הסרת הוראות WeWeb**:
   - מחיקת ההוראות ל-WeWeb בסוף המסמך
   - החלפה בהוראות פיתוח React Web


5. **הוספת PWA ו-Monorepo**:
   - פלטפורמת הפצה מתקדמת
   - סביבת פיתוח מאורגנת


---


## הערות נוספות


- המסמך הזה הוא המסמך האחיד והיחיד לשימוש
- כל שינוי יתועד עם תאריך ונימוק  
- יש לשמור על עקביות עם המסמכים הקיימים
- שמירה מלאה על הלוגיקה העסקית והפונקציונליות המקורית
- שמירה מלאה על שדות, טבלאות ופונקציות כפי שהוגדרו


---
*